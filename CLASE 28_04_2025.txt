CREATE TRIGGER nombreTrigger 
ON  tabla/vista 
[ WITH <opciones> ]
[ FOR / AFTER / INSTEAD OF ]
[ INSERT / UPDATE / DELETE ]
AS [codigo]
	

CREATE TABLE CLIENTE (
ID_CLIENTE INT PRIMARY KEY NOT NULL,
NOMBRE_CLIENTE VARCHAR (50),
APELLIDO_CLIENTE VARCHAR (50),
DIRECCION_CLIENTE VARCHAR (50),
NRO_CUENTA11_CLI VARCHAR (50));

INSERT INTO CLIENTE VALUES (1,'MANUEL','QUIENTERO','CALLE 30','AH-2050')

SELECT * FROM sys.triggers

CREATE TRIGGER AVISO_CLIENTE 
ON CLIENTE INSTEAD OF DELETE 
AS 
PRINT 'SE VA A BORRAR UN REGISTRO DE LA TABLA CLIENTE'


IF EXIST 
	SELECT * FROM sys.triggers WHERE name = N'trigger.sysname, table_alter_drop_safety>'
	AND parent_class_desc

CREATE TRIGGER CUENTA_CLIENTE      
ON CLIENTE INSTEAD OF DELETE
AS 
BEGIN 
	DECLARE @ID_CLIENTE INT 
	
	SELECT @ID_CLIENTE = CLIENTE.ID_CLIENTE FROM CLIENTE 
	INNER JOIN inserted ON CLIENTE.ID_CLIENTE = inserted.ID_CLIENTE

	DELETE FROM CLIENTE
	WHERE ID_CLIENTE = @ID_CLIENTE

	PRINT 'SE VA A PROCEDER CON UN BORRADO DE REGISTROS DE LA TABLA'

END 

---EJEMPLOS DE TRIGGER
---DESARROLLAR UN TRIGGER QUE PERMITA CALCULAR UNA VENTA EN UNA FACTURA

--PASO 1 CREAR LAS TABLA SDE FACTURA DE VENTA (VENTA Y DETALLE)

CREATE TABLE VENTA (
IDVENTA INT PRIMARY KEY NOT NULL,
FECHAVENTA DATE, 
TOTAL_VENTA MONEY
);

CREATE TABLE PRODUCTO (
ID_PRODUCTO INT PRIMARY KEY NOT NULL,
ID_VENTA INT,
NOMBRE_PRODUCTO VARCHAR (100),
PRECIO_PRODUCTO INT,
FOREIGN KEY (ID_VENTA) REFERENCES VENTA  (IDVENTA)
);

INSERT INTO VENTA VALUES (1,'2025-04-28',10000)

INSERT INTO PRODUCTO VALUES (1,1,'COCA LITRO Y MEDIO',5000)
INSERT INTO PRODUCTO VALUES (2,1,'PAPAS DE LIMON',3000)
INSERT INTO PRODUCTO VALUES (3,1,'PASTEL DE POLLO',2000)

CREATE TRIGGER CALCULAR_VENTA 
ON PRODUCTO FOR UPDATE 
AS 
	DECLARE @IDVENTA INT = (SELECT ID_VENTA FROM inserted)
	UPDATE VENTA
	SET TOTAL_VENTA = (SELECT SUM(PRECIO) FROM PRODUCTO)
	WHERE IDVENTA  = @IDVENTA
	PRINT 'SE ACTUALIZO LA VENTA DE LOS PRODUCTOS'

SELECT * FROM sys.TRIGGERS

UPDATE PRODUCTO 
SET PRECIO_PRODUCTO = 70000
WHERE IDPRODUCTO = 1 

SELECT * FROM VENTA 